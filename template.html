<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="dist/css/monokai.css">
</head>
<body>
<style>
.full-image {
    display: block;
    width: 100%;
    height: 100%;
    position: absolute;
    object-fit: cover; /* Ensures the image covers the entire area without distortion */
    transition: scale 1.0s, opacity 0.5s;
    opacity: 1; /* Initial opacity */
}
 .fragment.scaled {
     scale: 1;
     transition: scale 3.0s;
 }
.fragment.scaled.visible {
    scale: 2;
    transition: scale 3.0s;
}
.fragment.no-fade {
    visibility: hidden;
    transition: visibility 0.0s;
}
.fragment.no-fade.visible {
    visibility: visible;
    transition: visibility 0.0s;
}

</style>

<div class="reveal">
    <div class="slides">
        <section class="reveal r-stretch" data-transition="fade"  data-background-image="dist/images/background.png" >
            <div class="title-slide-content">
<!--                <img style="&#45;&#45;r-block-margin: 0; opacity: 1" src="dist/images/background.png" alt="Code Generation from Unified Robot Description Format (URDF) for Accelerated Robotics" class="full-image fragment fade-in">-->
                <img id="titleImage" style="--r-block-margin: 0;" src="dist/images/title_card.png" alt="Code Generation from Unified Robot Description Format (URDF) for Accelerated Robotics" class="full-image" >
                <div class="fragment fade-in" data-fragment-index="1">
                    <img style="--r-block-margin: 0;" src="dist/images/background.png" alt="Code Generation from Unified Robot Description Format (URDF) for Accelerated Robotics" class="full-image">
                    <img style="--r-block-margin: 0;" src="dist/images/background_icon.png" alt="Code Generation from Unified Robot Description Format (URDF) for Accelerated Robotics" class="full-image">
                </div>
                <div class="fragment no-fade" data-fragment-index="2">
                    <img style="--r-block-margin: 0;" src="dist/images/background.png" alt="Code Generation from Unified Robot Description Format (URDF) for Accelerated Robotics" class="full-image">
                </div>
                <!--                <img style="&#45;&#45;r-block-margin: 0; opacity: 1" src="dist/images/background_icon.png" alt="Code Generation from Unified Robot Description Format (URDF) for Accelerated Robotics" class="full-image fragment fade-in-then-out">-->
                <img style="--r-block-margin: 0;" src="dist/images/background_icon.png" alt="Code Generation from Unified Robot Description Format (URDF) for Accelerated Robotics" class="full-image fragment scaled" data-fragment-index="2">
             </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Introduction</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>I am a first time presenter and attender
                    <li>About me: I work as a robotics scientist at PickNik Robotics. I earned my PhD in computer
                        science from the University of New Hampshire on the topic of robot learning from demonstration.
                    <li>I was the primary developer of <code>generate_parameter_library</code>, a ROS 2 library with a
                        declarative syntax for managing parameters
                </ul>
            </div>
        </section>
        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Outline</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>Motivate the topic
                    <li>High level code concept for proposal
                    <li>Memory layout and performance
                    <li>Real robot application
                    <li>Summary: lessons learned
                </ul>
            </div>
        </section>


        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Motivation</h2>
            <div class="slide-content">
                <div style="display: flex; flex-direction: column">
                    <div style="text-align: center">
                        <img style="width: 1536px;" src="dist/images/paper.png">
                    </div>
                    <ul class="my-list" style="--spacing: 5vb; margin-top: 5vb">
                        <li>Performance improvements of more than 500x over the state-of-the-art
                        <li>Approach does not require high-power hardware
                        <li>FK implementations commonly use dynamic branching and joint-type polymorphism to compute transforms between link
                        <li>Developed a novel tracing compiler for robot kinematic
                    </ul>
                </div>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Motivation</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb; margin-top: 5vb">
                    <li>Compiler takes in standard Universal Robot Description Format (URDF) files
                    <li>Generates a minimal set of operations required to compute the function
                    <li>e.g. skip unneeded computations like fixed joints, unroll loops, setup data structure to optimize
                        SIMD exzecution
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Motivate the topic</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>Some algorithms need to run at incredible speeds for optimal performance
                    <li>This is especially true for common subroutines used by expensive algorithms
                    <li>For example, robot path planning with RRT depends on nearest neighbor lookup and forward
                        kinematics, and collision detection.
                    <li>Reference the Motion planning in micro-seconds paper (not only can you generate fast code, but
                        you can make it algorithmically different, e.g. doing collision check as the FK is done)
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Motivate the topic</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li> Software written by hardware manufactures has an inherit advantage because it can be written
                        with very specific platforms in mind and take advantage of hardware specific knowledge.
                    <li>For example, robot design with spherical wrist can decompose inverse kinematics into two stages
                        1) find the wrist angles to achieve the desired orientation and 2) find the position value
                        needed to find reach the desired Cartesian position.
                    <li>Generic IK solvers cannot take advantage of this kind of knowledge in general
                    <li>One downside of hardware specific implementations is scalability
                    <li>Hardware generally does not change very often, other than attachments, like cameras and end
                        effectors. Take a look at URDF?
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Motivate the topic</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>Compiled code can be tested for memory allocations and real-time compatibility (no locks,
                        exceptions, thread switching?). Safety critical applications, such as surgical robots need to
                        meet these requirements
                    <li>Allows for hardware specific CPU optimizations to be enabled since the code is source built on
                        every machine
                    <li>Some advantages of code generation as opposed to a templated robot builder are 1) less likely to
                        make a mistake building defining the robot 2) do not have to maintain code for each of your
                        robot
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Background</h2>
            <div class="slide-content" style="text-align: center">
                <img style="margin-left: 0vb;margin-top: -5vb; width: 1536px;" src="dist/images/sawyer1.png">
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Background</h2>
            <div class="slide-content" style="text-align: center">
                <img style="margin-top: -5vb; width: 1536px; position: absolute; transform: translate(-768px, 0);" src="dist/images/sawyer2.png">
                <img class="fragment fade-in" style="margin-top: -5vb;width: 1536px; position: absolute; transform: translate(-768px, 0);" src="dist/images/sawyer3.png">
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Concept video</h2>
                <div class="slide-content" style="text-align: center">
                    <img style="margin-top: -5vb; width: 1536px; position: absolute; transform: translate(-768px, 0);" src="dist/images/demo.gif">
                </div>
        </section>
        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Chart</h2>
            <div class="slide-content">
                <div>
                    <canvas id="myChart"></canvas>
                </div>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">High level code concept for proposal</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>Add slides showing how it should work in terms of user code, URDF, and cmake
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Go through example of how it is actually used for a simpler robot</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>Show the URDF
                    <li>Show cmake needed to generate the FK library
                    <li>Show how python code is called in cmake and how it parses the URDF and populates Jinja templates
                    <li>Which joint type are supported and how to implement them
                    <li>Show user code that links against it
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Concept video</h2>
            <div class="slide-content" style="text-align: right">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-900px, 0);" src="dist/images/jac_1.gif">
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Concept video</h2>
            <div class="slide-content" style="text-align: right">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-900px, 0);" src="dist/images/jac_2.gif">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-1550px, 0);" src="dist/images/jac_matrix.png">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-1550px, 0);" src="dist/images/jac_matrix_alpha.png">
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Concept video</h2>
            <div class="slide-content" style="text-align: right">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-900px, 0);" src="dist/images/jac_3.gif">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-1550px, 0);" src="dist/images/jac_matrix.png">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-1550px, 0);" src="dist/images/jac_matrix_alpha_2.png">
            </div>
        </section>


        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Concept video</h2>
            <div class="slide-content" style="text-align: right">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-900px, 0);" src="dist/images/jac_4.gif">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-1550px, 0);" src="dist/images/jac_matrix.png">
                <img style="margin-top: -5vb; height: 800px; position: absolute; transform: translate(-1550px, 0);" src="dist/images/jac_matrix_alpha_3.png">
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Concept video</h2>
            <div class="slide-content" style="text-align: right">
                <img style="margin-top: -5vb; width: 800px; position: absolute; transform: translate(-800px, 0);" src="dist/images/ik.gif">
            </div>
        </section>

        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre class="language-cmake"><code data-trim data-line-numbers="1-57|3-18">
{{FFK_cmake}}
          </code></pre>
        </section>

        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre class="python" ><code data-trim data-line-numbers>
{{getNumJoints_py}}
          </code></pre>
        </section>

        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre class="language-xml" ><code data-trim data-line-numbers="1-761|155-162|162-169|171-178|179-186|186-194|195-202|448-454">
{{robot_urdf}}
          </code></pre>
        </section>


        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre class="language-cmake"><code data-trim data-line-numbers="3-18|20-29|31-49">
{{FFK_cmake}}
          </code></pre>
        </section>

        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre class="python" ><code class="python" data-trim data-line-numbers="|9-20|22-41|43-49|53-79|82-90">
{{robotGen_py}}
          </code></pre>
        </section>

        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre><code class="language-cpp" data-trim data-line-numbers>
{{robotConfig_template}}
          </code></pre>
        </section>

        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre><code class="language-cpp" data-trim data-line-numbers>
{{forwardKinematicsLib_cpp}}
          </code></pre>
        </section>




        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre class="language-cmake"><code data-trim data-line-numbers="31-49|51-53|55-60">
{{FFK_cmake}}
          </code></pre>
        </section>


        <section class="reveal r-stretch" data-transition="none"  data-background-image="dist/images/background.png" >
            <div class="title-slide-content">
                <img style="--r-block-margin: 0;" src="dist/images/cmake1.gif" class="full-image" >
          </div>
        </section>
        <section class="reveal r-stretch" data-transition="none"  data-background-image="dist/images/background.png" >
            <div class="title-slide-content">
                <img style="--r-block-margin: 0;" src="dist/images/cmake2.gif" class="full-image" >
            </div>
        </section>
        <section class="reveal r-stretch" data-transition="none"  data-background-image="dist/images/background.png" >
            <div class="title-slide-content">
                <img style="--r-block-margin: 0;" src="dist/images/cmake3.gif" class="full-image" >
            </div>
        </section>



        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Memory layout and performance</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>The general strategy is to minimize cache misses and branching
                    <li>Take advantage of cache lines
                    <li>Explain some basics of FK matrix math
                    <li>Show different layout and there corresponding `perf` values
                    <li>show godbolt.org assembly output
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Real robot application</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>record `perf` value and compare to existing KDL
                    <li>Compare to KDL when compiled from source with native optimizations
                    <li>Dynamic dispatch vs. compile-time dispatch
                    <li>repeat for both FK and IK
                    <li>Show FK queries per second with CUDA generated code
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title">Summary: lessons learned</h2>
            <div class="slide-content">
                <ul class="my-list" style="--spacing: 5vb;">
                    <li>Leverage compile time optimization when needed in common robotics subroutines
                    <li>Leverage code generation to squeeze out as much performance as possible from both the CPU
                        optimizations and known hardware kinematic description.
                </ul>
            </div>
        </section>

        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre><code class="language-cpp" data-trim data-line-numbers>
{{main_cpp}}
          </code></pre>
        </section>
        <section class="reveal r-stretch code"  data-transition="fade" data-background-image="dist/images/background.png" >
          <pre class="language-cmake"><code data-trim data-line-numbers="1-4|6-25|26-33">
{{CMakeLists_txt}}
          </code></pre>
        </section>

        <section class="reveal r-stretch" data-transition="fade" data-background-image="dist/images/background.png" >
            <h2 class="title" style="margin-top: 20vb">Thank you!</h2>
            <h2 class="title" style="margin-top: 20vb">Questions?</h2>
        </section>
    </div>
</div>



<script src="dist/reveal.js"></script>
<script src="dist/notes/notes.js"></script>
<script src="dist/markdown/markdown.js"></script>
<link rel="stylesheet" href="dist/css/monokai.css"/>
<script src="dist/highlight/highlight.js"></script>
<!--<script src="plugin/highlight/plugin.js"></script>-->
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        margin: 0,    // set margin to 0 for 1:1 scale
        minScale: 1.0,  // Ensure slides are not scaled below 1.0
        maxScale: 1.0,  // Ensure slides are not scaled above 1.0
        width: 1920,
        height: 1080,
        hash: true,
        slideNumber: true,
        transitionSpeed: 'fast',
        highlight: {
            highlightOnLoad: true,
        },
        // backgroundTransition: 'slide',
        background: {
            image: 'dist/images/title_card.png',
            size: 'cover', // to cover the entire slide
            position: 'center', // to center the image
            repeat: 'repeat' // to avoid repeating the image
        },
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
    }).then(() => {
        const highlight = Reveal.getPlugin('highlight');
        console.log(highlight.hljs.listLanguages())
    });
</script>
<script>
    const elems = document.querySelectorAll('.language-cmake .hljs-variable')
    // console.log(elems)
    elems.forEach((elem, index)=>{
        elem.innerHTML = elem.innerHTML.slice(2, elem.innerHTML.length - 1)
        });
    const elems_cpp = document.querySelectorAll('.language-cpp .hljs-keyword')
    elems_cpp.forEach((elem, index)=>{
        console.log(elem.innerHTML)

        if (elem.innerHTML==='include'){
            elem.className = '.language-cpp .hljs-meta'
        }
    });

</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const ctx = document.getElementById('myChart');
    Chart.defaults.font.size = 45;

    const plugin = {
        id: 'customCanvasBackgroundColor',
        beforeDraw: (chart, args, options) => {
            const {ctx} = chart;
            ctx.save();
            ctx.globalCompositeOperation = 'destination-over';
            ctx.fillStyle = options.color || '#99ffff';
            ctx.fillRect(0, 0, chart.width, chart.height);
            ctx.restore();
        }
    };

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Test 1', 'Test 2', 'Test 3', 'Test 4'],
            datasets: [{
                data: [12, 19, 3, 5],
                borderWidth: 1
            },
            {
                data: [12, 19, 3, 5],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                customCanvasBackgroundColor: {
                    color: 'white',
                },
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: 'Runtime Comparison (nano seconds)'
                }
            }
        },
        plugins: [plugin],
    });
</script>
</body>
</html>
